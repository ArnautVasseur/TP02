"use strict";var le=Object.create;var M=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var r in t)M(e,r,{get:t[r],enumerable:!0})},G=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ye(t))!ue.call(e,n)&&n!==r&&M(e,n,{get:()=>t[n],enumerable:!(i=fe(t,n))||i.enumerable});return e};var W=(e,t,r)=>(r=e!=null?le(me(e)):{},G(t||!e||!e.__esModule?M(r,"default",{value:e,enumerable:!0}):r,e)),ge=e=>G(M({},"__esModule",{value:!0}),e);var Re={};de(Re,{default:()=>Me});module.exports=ge(Re);var ae=require("@vue/compiler-sfc");var re=W(require("fs"));var R=require("fs"),m=require("path"),z=W(require("fast-glob")),J=require("local-pkg"),V=require("@vue/compiler-sfc");function v(e){return(0,V.babelParse)(e,{sourceType:"module",plugins:["typescript","topLevelAwait"]}).program}function Te(e,t){if(e instanceof RegExp)return e.test(t);if(t.length<e.length)return!1;if(t===e)return!0;let r=t.indexOf(e)===0,i=t.slice(e.length)[0]==="/";return r&&i}function xe(e){let t;for(;;){if(!e)return;let r=(0,m.dirname)(e);if(r===e)return;if(e=r,t=(0,m.join)(e,"package.json"),(0,R.existsSync)(t))break}return t}function Se(e,t,r){let i=r==null?void 0:r.find(o=>Te(o.find,e));if(i)return e.replace(i.find,i.replacement);let n=(0,J.resolveModule)(e==="."?"./index":e);if(!n)return(0,m.join)((0,m.dirname)(t),e);if((0,m.extname)(n)===".ts")return n;{let o=xe(n);if(!o)return;let{types:l,typings:x}=JSON.parse((0,R.readFileSync)(o,"utf-8")),c;try{c=(0,m.join)((0,m.dirname)(o),l||x)}catch{}return c}}async function K(e,t,r){var o;let i=(o=Se(e,t,r))==null?void 0:o.replace(/\\/g,"/");if(!i)return null;let n=await(0,z.default)([`${i}`,`${i}*.+(ts|d.ts)`,`${i}*/index.+(ts|d.ts)`],{onlyFiles:!0});return n.length?n[0]:null}function H(e){return e.reduce((t,r)=>(t[r.path]=t[r.path]||[],t[r.path].push(r.imported),t),{})}function Y(e,t){let r=new Set(t);return[...new Set(e)].filter(i=>r.has(i))}function q(e,t,r=!1){t.sort((n,o)=>o.start-n.start);let i=e;for(let n of t)i=i.slice(0,n.start)+n.replacement+i.slice(n.end);return r&&(i=i.split(`
`).filter(n=>n).join(`
`)),i}function Q(e,t,r){return e.slice(0,t)+r+e.slice(t)}var Ae="defineProps",Ie="defineEmits",be="withDefaults",he=["TSTypeAliasDeclaration","TSInterfaceDeclaration","TSEnumDeclaration"],X=e=>C(e,Ae),Z=e=>C(e,Ie),ee=e=>C(e,be);function Ne(e){let t=[],r=[],i=n=>{for(let o of n.specifiers)o.type==="ImportSpecifier"&&o.imported.type==="Identifier"&&t.push({start:o.imported.start,end:o.local.end,imported:o.imported.name,local:o.local.name,path:n.source.value});r.push(n)};for(let n of e.body)n.type==="ImportDeclaration"&&n.specifiers.length&&i(n);return{imports:t,importNodes:r}}function Ee(e){let t=[],r=i=>{for(let n of i.specifiers)n.type==="ExportSpecifier"&&n.exported.type==="Identifier"&&t.push({start:n.exported.start,end:n.local.end,imported:n.exported.name,local:n.local.name,path:i.source.value})};for(let i of e.body)De(i)&&r(i);return t}function ie(e){let t=[],r=i=>{var n;if(i.type==="CallExpression"&&((n=i.typeParameters)==null?void 0:n.type)==="TSTypeParameterInstantiation"){let o=i.typeParameters.params[0];o.type==="TSTypeReference"&&o.typeName.type==="Identifier"&&t.push(o.typeName.name)}};for(let i of e.body)if(i.type==="ExpressionStatement"&&(ee(i.expression)?r(i.expression.arguments[0]):(X(i.expression)||Z(i.expression))&&r(i.expression)),i.type==="VariableDeclaration"&&!i.declare)for(let n of i.declarations)n.init&&(ee(n.init)?r(n.init.arguments[0]):(X(n.init)||Z(n.init))&&r(n.init));return t}function Pe(e,t){return e.body.map(r=>r.type==="ExportNamedDeclaration"&&r.declaration&&ne(r.declaration,t)?r.declaration:ne(r,t)?r:null).filter(r=>r!==null)}async function O(e,t,r){let{relativePath:i,aliases:n,ast:o=v(e),isInternal:l=!1,cleanInterface:x=!1,extractedTypes:c=new Map,metaDataMap:S=new Map}=r,A=[],{imports:I,importNodes:b}=Ne(o);l||I.push(...Ee(o));let F=E(Pe(o,l)),w=[],f=[],h=(a,s)=>te(a)&&te(s)?e.slice(a,s):"";function N(a){f.push({start:a.start,end:a.end,replacement:""})}function E(a){let s=new Map;for(let p of a)"name"in p.id&&s.set(p.id.name,p);return s}function d(a){switch(a.type){case"TSTypeAliasDeclaration":{pe(a);break}case"TSInterfaceDeclaration":{se(a);break}case"TSEnumDeclaration":{ce(a);break}}}function u(a){if(c.get(a))return;let s=F.get(a);s?d(s):A.push(a)}let L=async(a,s)=>{let p=await K(a,i,n);if(!p)return;let y=re.default.readFileSync(p,"utf-8");await O(y,s,{relativePath:p,aliases:n,extractedTypes:c,metaDataMap:S})},P=a=>{a.types.filter(s=>s.type==="TSTypeReference").forEach(s=>{s.typeName.type==="Identifier"&&u(s.typeName.name)})};function B(a,s){for(let p of a)if(p.expression.type==="Identifier"){let y=p.expression.name;S.set(y,s),l&&w.push(y),u(y)}}let se=a=>{var _,j;let{extendInterfaceName:s,interfaceBodyStart:p,isProperty:y}=S.get(a.id.name)??{},g=a.id.name,D=a.extends;if(y){c.set(g,`interface ${g} {}`);return}let $=a.body.start,U=a.body.end;s?(c.set(s,Q(c.get(s),p+1,h($+1,U-1))),l&&x&&N(a),D&&B(D,{extendInterfaceName:s,interfaceBodyStart:p})):(c.set(g,`interface ${g} ${h($,U)}`),D?(l&&N(a),B(D,{extendInterfaceName:g,interfaceBodyStart:g.length+11})):l&&c.delete(g));for(let T of a.body.body)T.type==="TSPropertySignature"&&(((_=T.typeAnnotation)==null?void 0:_.typeAnnotation.type)==="TSUnionType"?P(T.typeAnnotation.typeAnnotation):((j=T.typeAnnotation)==null?void 0:j.typeAnnotation.type)==="TSTypeReference"&&T.typeAnnotation.typeAnnotation.typeName.type==="Identifier"&&(S.set(T.typeAnnotation.typeAnnotation.typeName.name,{isProperty:!0}),u(T.typeAnnotation.typeAnnotation.typeName.name)))},pe=a=>{c.set(a.id.name,h(a.start,a.end)),a.typeAnnotation.type==="TSUnionType"&&P(a.typeAnnotation),a.typeAnnotation.type==="TSTypeReference"&&a.typeAnnotation.typeName.type==="Identifier"&&u(a.typeAnnotation.typeName.name)},ce=a=>{let s=a.id.name,p=new Set;for(let y of a.members)y.initializer?y.initializer.type==="NumericLiteral"?p.add("number"):y.initializer.type==="StringLiteral"&&p.add("string"):p.add("number");c.set(s,`type ${s} = ${[...p].join(" | ")||"number | string"};`)};for(let a of t)u(a);return A.length&&await Promise.all(Object.entries(H(I)).map(async([a,s])=>{let p=Y(s,A);p.length&&await L(a,p)})),{result:c,importNodes:b,extraSpecifiers:w,extraReplacements:f}}function te(e){return typeof e=="number"}function C(e,t){return!!(e&&e.type==="CallExpression"&&e.callee.type==="Identifier"&&(typeof t=="string"?e.callee.name===t:t(e.callee.name)))}function ne(e,t){return t?!!(e&&e.type==="TSInterfaceDeclaration"):!!(e&&he.includes(e.type))}function De(e){return!!(e&&e.type==="ExportNamedDeclaration"&&e.source)}async function oe(e,{id:t,aliases:r,clean:i}){let{descriptor:{scriptSetup:n}}=(0,ae.parse)(e);if((n==null?void 0:n.lang)!=="ts"||!n.content)return e;let o=v(n.content),l=ie(o),{result:x,importNodes:c,extraSpecifiers:S,extraReplacements:A}=await O(n.content,l,{aliases:r,relativePath:t,ast:o,isInternal:!0,cleanInterface:i.interface});if(!x.size)return e;let I=[...x].reverse(),b=A;c.forEach(f=>{let h=f.specifiers[0].start,N=f.specifiers[f.specifiers.length-1].end,E=f.specifiers.map(d=>{if(d.type==="ImportSpecifier"&&d.imported.type==="Identifier"){let u=d.imported.name;return!I.some(P=>P[0]===u)&&!S.includes(u)?u:null}return null}).filter(d=>d!==null);E.length?b.push({start:h,end:N,replacement:E.join(", ")}):b.push({start:f.start,end:f.end,replacement:""})});let F=I.map(f=>f[1]).join(`
`);return[e.slice(0,n.loc.start.offset),F,q(n.content,b,i.newline),e.slice(n.loc.end.offset)].join(`
`)}function k(e={}){let t=e.clean??{},r;return{name:"vite-plugin-vue-type-imports",enforce:"pre",async configResolved(i){r=i},async transform(i,n){if(!/\.(vue)$/.test(n))return;let o=r==null?void 0:r.resolve.alias;return{code:await oe(i,{id:n,aliases:o,clean:t})}}}}function Me(){this.nuxt.hook("vite:extend",async e=>{e.config.plugins=e.config.plugins||[],e.config.plugins.unshift(k())})}0&&(module.exports={});
