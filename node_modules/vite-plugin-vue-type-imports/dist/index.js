"use strict";var le=Object.create;var M=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var r in t)M(e,r,{get:t[r],enumerable:!0})},G=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ye(t))!ue.call(e,n)&&n!==r&&M(e,n,{get:()=>t[n],enumerable:!(a=fe(t,n))||a.enumerable});return e};var W=(e,t,r)=>(r=e!=null?le(me(e)):{},G(t||!e||!e.__esModule?M(r,"default",{value:e,enumerable:!0}):r,e)),Te=e=>G(M({},"__esModule",{value:!0}),e);var Re={};de(Re,{default:()=>Me});module.exports=Te(Re);var ie=require("@vue/compiler-sfc");var re=W(require("fs"));var R=require("fs"),m=require("path"),z=W(require("fast-glob")),J=require("local-pkg"),V=require("@vue/compiler-sfc");function v(e){return(0,V.babelParse)(e,{sourceType:"module",plugins:["typescript","topLevelAwait"]}).program}function ge(e,t){if(e instanceof RegExp)return e.test(t);if(t.length<e.length)return!1;if(t===e)return!0;let r=t.indexOf(e)===0,a=t.slice(e.length)[0]==="/";return r&&a}function xe(e){let t;for(;;){if(!e)return;let r=(0,m.dirname)(e);if(r===e)return;if(e=r,t=(0,m.join)(e,"package.json"),(0,R.existsSync)(t))break}return t}function Se(e,t,r){let a=r==null?void 0:r.find(o=>ge(o.find,e));if(a)return e.replace(a.find,a.replacement);let n=(0,J.resolveModule)(e==="."?"./index":e);if(!n)return(0,m.join)((0,m.dirname)(t),e);if((0,m.extname)(n)===".ts")return n;{let o=xe(n);if(!o)return;let{types:l,typings:x}=JSON.parse((0,R.readFileSync)(o,"utf-8")),c;try{c=(0,m.join)((0,m.dirname)(o),l||x)}catch{}return c}}async function K(e,t,r){var o;let a=(o=Se(e,t,r))==null?void 0:o.replace(/\\/g,"/");if(!a)return null;let n=await(0,z.default)([`${a}`,`${a}*.+(ts|d.ts)`,`${a}*/index.+(ts|d.ts)`],{onlyFiles:!0});return n.length?n[0]:null}function H(e){return e.reduce((t,r)=>(t[r.path]=t[r.path]||[],t[r.path].push(r.imported),t),{})}function Y(e,t){let r=new Set(t);return[...new Set(e)].filter(a=>r.has(a))}function q(e,t,r=!1){t.sort((n,o)=>o.start-n.start);let a=e;for(let n of t)a=a.slice(0,n.start)+n.replacement+a.slice(n.end);return r&&(a=a.split(`
`).filter(n=>n).join(`
`)),a}function Q(e,t,r){return e.slice(0,t)+r+e.slice(t)}var Ae="defineProps",Ie="defineEmits",be="withDefaults",he=["TSTypeAliasDeclaration","TSInterfaceDeclaration","TSEnumDeclaration"],X=e=>C(e,Ae),Z=e=>C(e,Ie),ee=e=>C(e,be);function Ne(e){let t=[],r=[],a=n=>{for(let o of n.specifiers)o.type==="ImportSpecifier"&&o.imported.type==="Identifier"&&t.push({start:o.imported.start,end:o.local.end,imported:o.imported.name,local:o.local.name,path:n.source.value});r.push(n)};for(let n of e.body)n.type==="ImportDeclaration"&&n.specifiers.length&&a(n);return{imports:t,importNodes:r}}function Ee(e){let t=[],r=a=>{for(let n of a.specifiers)n.type==="ExportSpecifier"&&n.exported.type==="Identifier"&&t.push({start:n.exported.start,end:n.local.end,imported:n.exported.name,local:n.local.name,path:a.source.value})};for(let a of e.body)De(a)&&r(a);return t}function ae(e){let t=[],r=a=>{var n;if(a.type==="CallExpression"&&((n=a.typeParameters)==null?void 0:n.type)==="TSTypeParameterInstantiation"){let o=a.typeParameters.params[0];o.type==="TSTypeReference"&&o.typeName.type==="Identifier"&&t.push(o.typeName.name)}};for(let a of e.body)if(a.type==="ExpressionStatement"&&(ee(a.expression)?r(a.expression.arguments[0]):(X(a.expression)||Z(a.expression))&&r(a.expression)),a.type==="VariableDeclaration"&&!a.declare)for(let n of a.declarations)n.init&&(ee(n.init)?r(n.init.arguments[0]):(X(n.init)||Z(n.init))&&r(n.init));return t}function Pe(e,t){return e.body.map(r=>r.type==="ExportNamedDeclaration"&&r.declaration&&ne(r.declaration,t)?r.declaration:ne(r,t)?r:null).filter(r=>r!==null)}async function O(e,t,r){let{relativePath:a,aliases:n,ast:o=v(e),isInternal:l=!1,cleanInterface:x=!1,extractedTypes:c=new Map,metaDataMap:S=new Map}=r,A=[],{imports:I,importNodes:b}=Ne(o);l||I.push(...Ee(o));let F=E(Pe(o,l)),w=[],f=[],h=(i,s)=>te(i)&&te(s)?e.slice(i,s):"";function N(i){f.push({start:i.start,end:i.end,replacement:""})}function E(i){let s=new Map;for(let p of i)"name"in p.id&&s.set(p.id.name,p);return s}function d(i){switch(i.type){case"TSTypeAliasDeclaration":{pe(i);break}case"TSInterfaceDeclaration":{se(i);break}case"TSEnumDeclaration":{ce(i);break}}}function u(i){if(c.get(i))return;let s=F.get(i);s?d(s):A.push(i)}let k=async(i,s)=>{let p=await K(i,a,n);if(!p)return;let y=re.default.readFileSync(p,"utf-8");await O(y,s,{relativePath:p,aliases:n,extractedTypes:c,metaDataMap:S})},P=i=>{i.types.filter(s=>s.type==="TSTypeReference").forEach(s=>{s.typeName.type==="Identifier"&&u(s.typeName.name)})};function B(i,s){for(let p of i)if(p.expression.type==="Identifier"){let y=p.expression.name;S.set(y,s),l&&w.push(y),u(y)}}let se=i=>{var _,j;let{extendInterfaceName:s,interfaceBodyStart:p,isProperty:y}=S.get(i.id.name)??{},T=i.id.name,D=i.extends;if(y){c.set(T,`interface ${T} {}`);return}let $=i.body.start,U=i.body.end;s?(c.set(s,Q(c.get(s),p+1,h($+1,U-1))),l&&x&&N(i),D&&B(D,{extendInterfaceName:s,interfaceBodyStart:p})):(c.set(T,`interface ${T} ${h($,U)}`),D?(l&&N(i),B(D,{extendInterfaceName:T,interfaceBodyStart:T.length+11})):l&&c.delete(T));for(let g of i.body.body)g.type==="TSPropertySignature"&&(((_=g.typeAnnotation)==null?void 0:_.typeAnnotation.type)==="TSUnionType"?P(g.typeAnnotation.typeAnnotation):((j=g.typeAnnotation)==null?void 0:j.typeAnnotation.type)==="TSTypeReference"&&g.typeAnnotation.typeAnnotation.typeName.type==="Identifier"&&(S.set(g.typeAnnotation.typeAnnotation.typeName.name,{isProperty:!0}),u(g.typeAnnotation.typeAnnotation.typeName.name)))},pe=i=>{c.set(i.id.name,h(i.start,i.end)),i.typeAnnotation.type==="TSUnionType"&&P(i.typeAnnotation),i.typeAnnotation.type==="TSTypeReference"&&i.typeAnnotation.typeName.type==="Identifier"&&u(i.typeAnnotation.typeName.name)},ce=i=>{let s=i.id.name,p=new Set;for(let y of i.members)y.initializer?y.initializer.type==="NumericLiteral"?p.add("number"):y.initializer.type==="StringLiteral"&&p.add("string"):p.add("number");c.set(s,`type ${s} = ${[...p].join(" | ")||"number | string"};`)};for(let i of t)u(i);return A.length&&await Promise.all(Object.entries(H(I)).map(async([i,s])=>{let p=Y(s,A);p.length&&await k(i,p)})),{result:c,importNodes:b,extraSpecifiers:w,extraReplacements:f}}function te(e){return typeof e=="number"}function C(e,t){return!!(e&&e.type==="CallExpression"&&e.callee.type==="Identifier"&&(typeof t=="string"?e.callee.name===t:t(e.callee.name)))}function ne(e,t){return t?!!(e&&e.type==="TSInterfaceDeclaration"):!!(e&&he.includes(e.type))}function De(e){return!!(e&&e.type==="ExportNamedDeclaration"&&e.source)}async function oe(e,{id:t,aliases:r,clean:a}){let{descriptor:{scriptSetup:n}}=(0,ie.parse)(e);if((n==null?void 0:n.lang)!=="ts"||!n.content)return e;let o=v(n.content),l=ae(o),{result:x,importNodes:c,extraSpecifiers:S,extraReplacements:A}=await O(n.content,l,{aliases:r,relativePath:t,ast:o,isInternal:!0,cleanInterface:a.interface});if(!x.size)return e;let I=[...x].reverse(),b=A;c.forEach(f=>{let h=f.specifiers[0].start,N=f.specifiers[f.specifiers.length-1].end,E=f.specifiers.map(d=>{if(d.type==="ImportSpecifier"&&d.imported.type==="Identifier"){let u=d.imported.name;return!I.some(P=>P[0]===u)&&!S.includes(u)?u:null}return null}).filter(d=>d!==null);E.length?b.push({start:h,end:N,replacement:E.join(", ")}):b.push({start:f.start,end:f.end,replacement:""})});let F=I.map(f=>f[1]).join(`
`);return[e.slice(0,n.loc.start.offset),F,q(n.content,b,a.newline),e.slice(n.loc.end.offset)].join(`
`)}function L(e={}){let t=e.clean??{},r;return{name:"vite-plugin-vue-type-imports",enforce:"pre",async configResolved(a){r=a},async transform(a,n){if(!/\.(vue)$/.test(n))return;let o=r==null?void 0:r.resolve.alias;return{code:await oe(a,{id:n,aliases:o,clean:t})}}}}var Me=L;0&&(module.exports={});
